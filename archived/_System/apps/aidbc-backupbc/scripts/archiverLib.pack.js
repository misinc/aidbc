/** BackupBC v1.5 - Archiver Library v1.0                        **/
/** http://www.backupbc.com/                                      **/
/** Based on the JSZip plugin from http://stuk.github.io/jszip/   **/
var Archiver=function(b){this.version="1.0";this.archiveOpts={filename:"zipFile"+(new Date().toDateString()),compression:"STORE",base64:true,type:"base64"};this.archiveOpts=simpleExtender(b,this.archiveOpts);this.files={};this.generatedZip={filename:"",archive:false,percentProcessed:0,percentWritten:0,percentEncoded:0};this.root="";this.fileOpts={base64:false,binary:false,dir:false,date:false};this.compressions={"STORE":{magic:"\x00\x00",compress:function(a){return a},compressInputType:null,uncompress:function(a){return a},uncompressInputType:null},"DEFLATE":{magic:"\x08\x00",compress:function(a){return new Zlib.Deflate(a).compress()},compressInputType:"uint8array",uncompress:function(a){return new Zlib.Deflate(array).decompress()},uncompressInputType:"uint8array"}};this.zipSigs={localHead:"\x50\x4b\x03\x04",centralHead:"\x50\x4b\x01\x02",centralEnd:"\x50\x4b\x05\x06"}},simpleExtender=function(a,b){a=a||{};for(var c in b){if(typeof b[c]==='object'){simpleExtender(a[c],b[c])}else{if(typeof a[c]==="undefined"){a[c]=b[c]}}}return a};Archiver.prototype=(function(){var h=function(a,b,c){this.name=a;this.data=b;this.options=c},parentDir=function(a){a=(a.slice(-1)=='/')?a.substring(0,a.length-1):a;return(a.lastIndexOf('/')>0)?a.substring(0,a.lastIndexOf('/')):""},fileAdd=function(a,b,c){var d=parentDir(a),dataType=getDataType(b);c=simpleExtender(c,this.fileOpts);c.date=new Date();if(d){folderAdd.call(this,d)}if(c.dir||b===null||typeof b==="undefined"){c.base64=false;c.binary=false;b=null}else if(dataType==="string"){if(c.binary&&!c.base64){b=xformUtils.string2bin(b)}}else{c.base64=false;c.binary=true;if(dataType==="arraybuffer"){b=xform("uint8array",b)}}var e=new h(a,b,c);this.files[a]=e;return e},folderAdd=function(a){a+=(a.slice(-1)!="/")?"/":"";if(!this.files[a]){fileAdd.call(this,a,null,{dir:true})}return this.files[a]},CompressedObject=function(){this.compressedSize=0;this.uncompressedSize=0;this.crc32=0;this.compressionMethod=null;this.compressedContent=null},generateCompressedObjectFrom=function(a,b){var c=new CompressedObject(),data=dataUtils.getBinaryData(a);if(!data||data.length===0||a.options.dir){b=this.compressions['STORE'];data=""}c.uncompressedSize=data.length;c.crc32=dataUtils.crc32(data);c.compressedContent=b.compress(xform(b.compressInputType,data));c.compressedSize=c.compressedContent.length;c.compressionMethod=b.magic;return c},generateZipParts=function(a,b,c){var d=xformUtils.utf8encode(a.name),useUTF8=d!==a.name,opts=a.options,dosTime=opts.date.getHours(),dosDate=opts.date.getFullYear()-1980,header="";dosTime=dosTime<<6;dosTime=dosTime|opts.date.getMinutes();dosTime=dosTime<<5;dosTime=dosTime|opts.date.getSeconds()/2;dosDate=dosDate<<4;dosDate=dosDate|(opts.date.getMonth()+1);dosDate=dosDate<<5;dosDate=dosDate|opts.date.getDate();header+="\x0A\x00";header+=useUTF8?"\x00\x08":"\x00\x00";header+=b.compressionMethod;header+=dataUtils.decToHex(dosTime,2);header+=dataUtils.decToHex(dosDate,2);header+=dataUtils.decToHex(b.crc32,4);header+=dataUtils.decToHex(b.compressedSize,4);header+=dataUtils.decToHex(b.uncompressedSize,4);header+=dataUtils.decToHex(d.length,2);header+="\x00\x00";var e=this.zipSigs.localHead+header+d,dirRecord=this.zipSigs.centralHead+"\x14\x00"+header+"\x00\x00"+"\x00\x00"+"\x00\x00";dirRecord+=(a.options.dir===true?"\x10\x00\x00\x00":"\x00\x00\x00\x00");dirRecord+=dataUtils.decToHex(c,4)+d;return{fileRecord:e,dirRecord:dirRecord}},StringWriter=function(){this.data=[]},Uint8ArrayWriter=function(a){this.data=new Uint8Array(a);this.index=0},getDataType=function(a){switch(true){case(typeof a==="string"):return"string";case(Object.prototype.toString.call(a)==="[object Array]"):return"array";case(a instanceof Uint8Array):return"uint8array";case(a instanceof ArrayBuffer):return"arraybuffer"}},xform=function(a,b){b=(!b)?"":b;if(!a||typeof a===null){return b}return xformUtils.xformMatrix[getDataType(b)][a](b)},dataUtils={getBinaryData:function(a){var b=a.data;if(getDataType(b)==="string"){if(!a.options.binary){return xformUtils.utf8encode(b)}else{return a.asBinary()}}else{return b}},dataToString:function(a){var b=this.data;if(b===null||typeof b==="undefined"){return""}if(this.options.base64){b=xformUtils.base64.decode(b)}if(a&&this.options.binary){b=xformUtils.utf8decode(xform("uint8array",b))}else{b=xform("string",b)}if(!a&&!this.options.binary){b=xform("string",xformUtils.utf8encode(b))}return b},crc32:function crc32(a,b){if(typeof a==="undefined"||!a.length){return 0}if(typeof(b)==="undefined"){b=0}var c=getDataType(a)!=="string",x=0,byte=0,table=[0x00000000,0x77073096,0xEE0E612C,0x990951BA,0x076DC419,0x706AF48F,0xE963A535,0x9E6495A3,0x0EDB8832,0x79DCB8A4,0xE0D5E91E,0x97D2D988,0x09B64C2B,0x7EB17CBD,0xE7B82D07,0x90BF1D91,0x1DB71064,0x6AB020F2,0xF3B97148,0x84BE41DE,0x1ADAD47D,0x6DDDE4EB,0xF4D4B551,0x83D385C7,0x136C9856,0x646BA8C0,0xFD62F97A,0x8A65C9EC,0x14015C4F,0x63066CD9,0xFA0F3D63,0x8D080DF5,0x3B6E20C8,0x4C69105E,0xD56041E4,0xA2677172,0x3C03E4D1,0x4B04D447,0xD20D85FD,0xA50AB56B,0x35B5A8FA,0x42B2986C,0xDBBBC9D6,0xACBCF940,0x32D86CE3,0x45DF5C75,0xDCD60DCF,0xABD13D59,0x26D930AC,0x51DE003A,0xC8D75180,0xBFD06116,0x21B4F4B5,0x56B3C423,0xCFBA9599,0xB8BDA50F,0x2802B89E,0x5F058808,0xC60CD9B2,0xB10BE924,0x2F6F7C87,0x58684C11,0xC1611DAB,0xB6662D3D,0x76DC4190,0x01DB7106,0x98D220BC,0xEFD5102A,0x71B18589,0x06B6B51F,0x9FBFE4A5,0xE8B8D433,0x7807C9A2,0x0F00F934,0x9609A88E,0xE10E9818,0x7F6A0DBB,0x086D3D2D,0x91646C97,0xE6635C01,0x6B6B51F4,0x1C6C6162,0x856530D8,0xF262004E,0x6C0695ED,0x1B01A57B,0x8208F4C1,0xF50FC457,0x65B0D9C6,0x12B7E950,0x8BBEB8EA,0xFCB9887C,0x62DD1DDF,0x15DA2D49,0x8CD37CF3,0xFBD44C65,0x4DB26158,0x3AB551CE,0xA3BC0074,0xD4BB30E2,0x4ADFA541,0x3DD895D7,0xA4D1C46D,0xD3D6F4FB,0x4369E96A,0x346ED9FC,0xAD678846,0xDA60B8D0,0x44042D73,0x33031DE5,0xAA0A4C5F,0xDD0D7CC9,0x5005713C,0x270241AA,0xBE0B1010,0xC90C2086,0x5768B525,0x206F85B3,0xB966D409,0xCE61E49F,0x5EDEF90E,0x29D9C998,0xB0D09822,0xC7D7A8B4,0x59B33D17,0x2EB40D81,0xB7BD5C3B,0xC0BA6CAD,0xEDB88320,0x9ABFB3B6,0x03B6E20C,0x74B1D29A,0xEAD54739,0x9DD277AF,0x04DB2615,0x73DC1683,0xE3630B12,0x94643B84,0x0D6D6A3E,0x7A6A5AA8,0xE40ECF0B,0x9309FF9D,0x0A00AE27,0x7D079EB1,0xF00F9344,0x8708A3D2,0x1E01F268,0x6906C2FE,0xF762575D,0x806567CB,0x196C3671,0x6E6B06E7,0xFED41B76,0x89D32BE0,0x10DA7A5A,0x67DD4ACC,0xF9B9DF6F,0x8EBEEFF9,0x17B7BE43,0x60B08ED5,0xD6D6A3E8,0xA1D1937E,0x38D8C2C4,0x4FDFF252,0xD1BB67F1,0xA6BC5767,0x3FB506DD,0x48B2364B,0xD80D2BDA,0xAF0A1B4C,0x36034AF6,0x41047A60,0xDF60EFC3,0xA867DF55,0x316E8EEF,0x4669BE79,0xCB61B38C,0xBC66831A,0x256FD2A0,0x5268E236,0xCC0C7795,0xBB0B4703,0x220216B9,0x5505262F,0xC5BA3BBE,0xB2BD0B28,0x2BB45A92,0x5CB36A04,0xC2D7FFA7,0xB5D0CF31,0x2CD99E8B,0x5BDEAE1D,0x9B64C2B0,0xEC63F226,0x756AA39C,0x026D930A,0x9C0906A9,0xEB0E363F,0x72076785,0x05005713,0x95BF4A82,0xE2B87A14,0x7BB12BAE,0x0CB61B38,0x92D28E9B,0xE5D5BE0D,0x7CDCEFB7,0x0BDBDF21,0x86D3D2D4,0xF1D4E242,0x68DDB3F8,0x1FDA836E,0x81BE16CD,0xF6B9265B,0x6FB077E1,0x18B74777,0x88085AE6,0xFF0F6A70,0x66063BCA,0x11010B5C,0x8F659EFF,0xF862AE69,0x616BFFD3,0x166CCF45,0xA00AE278,0xD70DD2EE,0x4E048354,0x3903B3C2,0xA7672661,0xD06016F7,0x4969474D,0x3E6E77DB,0xAED16A4A,0xD9D65ADC,0x40DF0B66,0x37D83BF0,0xA9BCAE53,0xDEBB9EC5,0x47B2CF7F,0x30B5FFE9,0xBDBDF21C,0xCABAC28A,0x53B39330,0x24B4A3A6,0xBAD03605,0xCDD70693,0x54DE5729,0x23D967BF,0xB3667A2E,0xC4614AB8,0x5D681B02,0x2A6F2B94,0xB40BBE37,0xC30C8EA1,0x5A05DF1B,0x2D02EF8D];b=b^(-1);for(var i=0,iTop=a.length;i<iTop;i++){byte=c?a[i]:a.charCodeAt(i);b=(b>>>8)^table[(b^byte)&0xFF]}return b^(-1)},decToHex:function(a,b){var c="";for(var i=0;i<b;i++){c+=String.fromCharCode(a&0xff);a=a>>>8}return c}},xformUtils={utf8encode:function(a){var b=[],resIndex=0,len=a.length;for(var n=0;n<len;n++){var c=a.charCodeAt(n);if(c<128){b[resIndex++]=String.fromCharCode(c)}else if((c>127)&&(c<2048)){b[resIndex++]=String.fromCharCode((c>>6)|192);b[resIndex++]=String.fromCharCode((c&63)|128)}else{b[resIndex++]=String.fromCharCode((c>>12)|224);b[resIndex++]=String.fromCharCode(((c>>6)&63)|128);b[resIndex++]=String.fromCharCode((c&63)|128)}}return b.join("")},utf8decode:function(a){var b=[],resIndex=0,len=a.length,i=0,c=0,c1=0,c2=0,c3=0,isArray=getDataType(a)!=="string";while(i<len){c=isArray?a[i]:a.charCodeAt(i);if(c<128){b[resIndex++]=String.fromCharCode(c);i++}else if((c>191)&&(c<224)){c2=isArray?a[i+1]:a.charCodeAt(i+1);b[resIndex++]=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2}else{c2=isArray?a[i+1]:a.charCodeAt(i+1);c3=isArray?a[i+2]:a.charCodeAt(i+2);b[resIndex++]=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3}}return result.join("")},arrayFromTo:function(a,b){var i=a.length;do{b[i]=a[i--]}while(i);return b},stringToArray:function(a,b){var i=a.length;do{b[--i]=a.charCodeAt(i)&0xFF}while(i);return b},arrayToString:function(a){var b=65536,ret=[],len=a.length,type=getDataType(a),k=0;while(k<len&&b>1){try{ret.push((type==="array")?String.fromCharCode.apply(null,a.slice(k,Math.min(k+b,len))):String.fromCharCode.apply(null,a.subarray(k,Math.min(k+b,len))));k+=b}catch(e){b=Math.floor(b/2)}}return ret.join("")},string2bin:function(a){var b="",len=a.length;for(var i=0;i<len;i++){b+=String.fromCharCode(a.charCodeAt(i)&0xff)}return b},buffer2blob:function(a){return new Blob([a],{type:"application/zip"})},string2Blob:function(a){return xformUtils.buffer2blob(xform("arraybuffer",a))},base64:{key:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",getEncoded:function(c,d,e,f){var g="",i=0,inputLen=c.length,encoded=function(a){var b=c.charCodeAt(a),chr2=c.charCodeAt(a+1),chr3=c.charCodeAt(a+2),enc1=b>>2,enc2=((b&3)<<4)|(chr2>>4),enc3=((chr2&15)<<2)|(chr3>>6),enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else if(isNaN(chr3)){enc4=64}return xformUtils.base64.key.charAt(enc1)+xformUtils.base64.key.charAt(enc2)+xformUtils.base64.key.charAt(enc3)+xformUtils.base64.key.charAt(enc4)},encodePart=function(a){if(i<inputLen){g+=encoded(i);g+=encoded(i+3);g+=encoded(i+6);g+=encoded(i+9);g+=encoded(i+12);g+=encoded(i+15);g+=encoded(i+18);g+=encoded(i+21);g+=encoded(i+24);g+=encoded(i+27);i+=30;g+=encoded(i);g+=encoded(i+3);g+=encoded(i+6);g+=encoded(i+9);g+=encoded(i+12);g+=encoded(i+15);g+=encoded(i+18);g+=encoded(i+21);g+=encoded(i+24);g+=encoded(i+27);i+=30;g+=encoded(i);g+=encoded(i+3);g+=encoded(i+6);g+=encoded(i+9);g+=encoded(i+12);g+=encoded(i+15);g+=encoded(i+18);g+=encoded(i+21);g+=encoded(i+24);g+=encoded(i+27);i+=30;g+=encoded(i);g+=encoded(i+3);g+=encoded(i+6);g+=encoded(i+9);g+=encoded(i+12);g+=encoded(i+15);g+=encoded(i+18);g+=encoded(i+21);g+=encoded(i+24);g+=encoded(i+27);i+=30;g+=encoded(i);g+=encoded(i+3);g+=encoded(i+6);g+=encoded(i+9);g+=encoded(i+12);g+=encoded(i+15);g+=encoded(i+18);g+=encoded(i+21);g+=encoded(i+24);g+=encoded(i+27);i+=30;e.generatedZip.percentEncoded=i/inputLen;encodePart(a)}else{a()}};encodePart(function(){f(g)})},decode:function(a,b){var c="",chr1,chr2,chr3,enc1,enc2,enc3,enc4,i=0;a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<a.length){enc1=xformUtils.base64.key.indexOf(a.charAt(i++));enc2=xformUtils.base64.key.indexOf(a.charAt(i++));enc3=xformUtils.base64.key.indexOf(a.charAt(i++));enc4=xformUtils.base64.key.indexOf(a.charAt(i++));chr1=(enc1<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;c=c+String.fromCharCode(chr1);if(enc3!=64){c=c+String.fromCharCode(chr2)}if(enc4!=64){c=c+String.fromCharCode(chr3)}}return c}},xformMatrix:{"string":{"string":function(a){return a},"array":function(a){return xformUtils.stringToArray(a,new Array(a.length))},"arraybuffer":function(a){return xformUtils.xformMatrix["string"]["uint8array"](a).buffer},"uint8array":function(a){return xformUtils.stringToArray(a,new Uint8Array(a.length))},},"array":{"string":function(a){return xformUtils.arrayToString(a)},"array":function(a){return a},"arraybuffer":function(a){return(new Uint8Array(a)).buffer},"uint8array":function(a){return new Uint8Array(a)},},"arraybuffer":{"string":function(a){return xformUtils.arrayToString(new Uint8Array(a))},"array":function(a){return xformUtils.arrayFromTo(new Uint8Array(a),new Array(a.byteLength))},"arraybuffer":function(a){return a},"uint8array":function(a){return new Uint8Array(a)},},"uint8array":{"string":function(a){return xformUtils.arrayToString(a)},"array":function(a){return xformUtils.arrayFromTo(a,new Array(a.length))},"arraybuffer":function(a){return a.buffer},"uint8array":function(a){return a},}}};h.prototype={asText:function(){return dataUtils.dataToString.call(this,true)},asBinary:function(){return dataUtils.dataToString.call(this,false)},asUint8Array:function(){return xform("uint8array",dataUtils.getBinaryData(this))},asArrayBuffer:function(){return this.asUint8Array().buffer}};StringWriter.prototype={append:function(a){this.data.push(xform("string",a))},finalize:function(){return this.data.join("")}};Uint8ArrayWriter.prototype={append:function(a){if(a.length!==0){a=xform("uint8array",a);this.data.set(a,this.index);this.index+=a.length}},finalize:function(){return this.data}};CompressedObject.prototype={};return{file:function(a,b,c){a=this.root+a;fileAdd.call(this,a,b,c);return this},folder:function(a){if(!a){return this}var b=folderAdd.call(this,this.root+a),obj=this.clone();obj.root=b.name;return obj},clone:function(){var a=new Archiver();for(var b in this){if(typeof this[b]!=="function"){a[b]=this[b]}}return a},createZip:function(e){e=simpleExtender(e,this.archiveOpts);var f=[],localDirLength=0,centralDirLength=0,writer,i,queue=[],totalFiles=0,self=this,processPart=function(a){if(!self.files.hasOwnProperty(a)){return false}var b=self.files[a],compressionName=e.compression.toUpperCase(),compression=self.compressions[compressionName.toUpperCase()],compressedObject=generateCompressedObjectFrom.call(self,b,compression),zipPart=generateZipParts.call(self,b,compressedObject,localDirLength);zipPart.compressedObject=compressedObject;localDirLength+=zipPart.fileRecord.length+compressedObject.compressedSize;centralDirLength+=zipPart.dirRecord.length;return zipPart},dequeuePart=function(a){if(queue.length){var b=4000;do{var c=queue.shift(),returned=processPart(c);if(returned||false){f.push(returned)}self.generatedZip.percentProcessed=(totalFiles-queue.length)/totalFiles}while(b--&&queue.length);dequeuePart(a)}else{a()}};for(var g in self.files){queue.push(g)}totalFiles=queue.length;dequeuePart(function(){var d=self.zipSigs.centralEnd+"\x00\x00\x00\x00"+dataUtils.decToHex(f.length,2)+dataUtils.decToHex(f.length,2)+dataUtils.decToHex(centralDirLength,4)+dataUtils.decToHex(localDirLength,4)+"\x00\x00",writerQueue=[],dequeueCnt=0,zipDataLen=f.length,dequeueWriter=function(){if(writerQueue.length){var b=4000;do{writer.append(writerQueue.shift());self.generatedZip.percentWritten=((zipDataLen*3)-writerQueue.length)/(zipDataLen*3)}while(b--&&writerQueue.length);dequeueWriter()}else{var c=writer.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":self.generatedZip.percentEncoded=false;self.generatedZip.archive=xform(e.type.toLowerCase(),c);break;case"blob":self.generatedZip.percentEncoded=false;self.generatedZip.archive=xformUtils.buffer2blob(xform("arraybuffer",c));break;case"base64":xformUtils.base64.getEncoded(c,false,self,function(a){self.generatedZip.archive=a});break;case"string":default:self.generatedZip.percentEncoded=false;self.generatedZip.archive=c;break}}};switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"blob":writer=new Uint8ArrayWriter(localDirLength+centralDirLength+d.length);break;default:writer=new StringWriter(localDirLength+centralDirLength+d.length);break}for(i=0;i<zipDataLen;i++){writerQueue.push(f[i].fileRecord);writerQueue.push(f[i].compressedObject.compressedContent)}for(i=0;i<zipDataLen;i++){writerQueue.push(f[i].dirRecord)}writerQueue.push(d);setTimeout(function(){dequeueWriter()},250)})},getZip:function(a,b,c,d){var e=this;if(e.generatedZip.filename==a){d(e.generatedZip.archive)}else{e.generatedZip.filename=a;e.generatedZip.archive=false;e.generatedZip.percentProcessed=0;e.generatedZip.percentWritten=0;e.generatedZip.percentEncoded=0;e.createZip(b);c(0.001,0);var f=setInterval(function(){if(e.generatedZip.archive){clearInterval(f);d(e.generatedZip.archive)}else{c(e.generatedZip.percentProcessed,e.generatedZip.percentWritten)}},200)}}}})();