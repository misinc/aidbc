var _currentMenuItems;var _currentMenuItemsArray;var _currentNavItemImage;var _currentNavItemAccessRightsButton;var _allAccessRightsList=[];var _workingMenuItem;var _menuFile=BCAPI.Models.FileSystem.Root.file("/_System/Apps/solid-admin-menus/_config/menu.json");var _webAppsFile=BCAPI.Models.FileSystem.Root.file("/_System/Apps/solid-admin-menus/webapps.json");var _originalMenuFile=BCAPI.Models.FileSystem.Root.file("/_System/Apps/solid-admin-menus/_config/menu_orig.json");var _menuIconsFolder=new BCAPI.Models.FileSystem.Folder("/_System/Apps/solid-admin-menus/_admin/content/menu-icons");var _adminMenuLabelsHtmlId="menu-custom-labels";var _invisibleTitle="Hidden from users";var _visibleTitle="Visible to all users";var _graybackButtonClass="greyback";var _yellowbackButtonClass="yellowback";var _linksToNewWindowTitle="Link opens in a new window";var _linksToAdminAreaTitle="Links opens in admin area";var _removesNavigationItemTitle="Removes navigation item";var _visibleGlyphiconClass="glyphicon-eye-open";var _invisibleGlyphiconClass="glyphicon-eye-close";var _linksToNewWindowGlyphiconClass="glyphicon-new-window";var _linksToAdminAreaGlyphiconClass="glyphicon-unchecked";var _removesNavigationItemGlyphiconClass="glyphicon-minus-sign";var _subNavigationExpandedGlyphiconClass="glyphicon-circle-arrow-down";var _subNavigationCollapsedGlyphiconClass="glyphicon-circle-arrow-right";var _accessRightsGlyphiconClass="glyphicon-user";var _defaultIconClass="default-icon";var _userDefinedNavItemClass="user-defined";var _validFileExtensions=[".png"];var _customIconClass="custom-icon";var _newNavTypeDropdownSelector;var _httpsRecommendedForAdminWindowWarningHtml="<div class=\"nav-item-warning-message alert alert-warning\">'https' is recommended for admin links for maximum compatibility. </div>";var _restrictedMenuItems=["menu-url-redirects","menu-customers-database","menu-payment-gateways","menu-shipping-options","menu-settings-domains","menu-settings-emailaccounts","menu-settings-adminusers","menu-settings-userroles","menu-billing-settings","menu-settings-secure-redirect"];var _bcRestrictedClass="restricted";var _webAppRestrictedClass="webapp-restricted";var _adminMenuRestrictedClass="adminmenu-restricted";function inIframe(){try{return window.self!==window.top}catch(a){return true}}function hasSubNavItems(a){return($(a).find(".sub-nav-items .nav-item-container").length>0)}function isAdminTarget(a){return $(a).find(".nav-item-toggle-target span."+_linksToAdminAreaGlyphiconClass).length===1}function reassignWeights(b){function a(c){$.each(c,function(d,e){$(e).find(".nav-item-weight input").first().val((d+1)*1)})}a(b.children("li").children(".nav-item-container"))}function postLoadNavigationData(){var a=$(".nav-item-container:not(.sub-nav-items .nav-item-container)","#left-admin-menu");$(".nav-item-warning-message").remove();var c=a.filter(function(){var i=$(this).find("input.input-url").val();return(i===""&&hasSubNavItems(this)===false)});$('<div class="nav-item-warning-message alert alert-warning">This item will not appear in the menu until either a URL is entered or sub menu items are added</div>').insertBefore(c.find(".sub-nav-items"));var d=a.filter(function(){var i=$(this).find("input.input-url:not(.sub-nav-items input.input-url)").val();return(i!==undefined&&i!==""&&hasSubNavItems(this)===true)});$('<div class="nav-item-warning-message alert alert-warning">It is not recommended to have a URL on a parent menu item when there are sub menu items</div>').insertBefore(d.find(".sub-nav-items"));var f=$(".sub-nav-items .nav-item-container","#left-admin-menu").filter(function(){var i=$(this).find("input.input-url").val();return(i!==undefined&&i==="")});f.append('<div class="nav-item-warning-message alert alert-warning">Sub menu items should have a URL</div>');var e=$(".nav-item-container:not(.sub-nav-items .nav-item-container)","#left-admin-menu").filter(function(){var i=$(this).find("input.input-url:not(.sub-nav-items input.input-url)").val();return(isAdminTarget(this)&&i!==undefined&&i!==""&&i.indexOf("https")!==0)});$(_httpsRecommendedForAdminWindowWarningHtml).insertBefore(e.find(".sub-nav-items"));var h=$(".nav-item-container","#top-admin-menu").filter(function(){var i=$(this).find("input.input-url").val();return(isAdminTarget(this)&&i!==undefined&&i!==""&&i.indexOf("https")!==0)});h.append(_httpsRecommendedForAdminWindowWarningHtml);var g=$(".sub-nav-items .nav-item-container","#left-admin-menu").filter(function(){var i=$(this).find("input.input-url").val();return(isAdminTarget(this)&&i!==undefined&&i!==""&&i.indexOf("https")!==0)});g.append(_httpsRecommendedForAdminWindowWarningHtml);a.filter(function(){return hasSubNavItems(this)===false}).find(".nav-item-toggle-subnav").hide();a.filter(function(){return hasSubNavItems(this)===true}).find(".nav-item-toggle-subnav").show();$(".nav-item-image:not(.blank)").unbind("click").click(function(){_currentNavItemImage=this;$("#fileUploadModal").modal({keyboard:false})});$(".nav-item-move-to-parent select").html('<option value="0">Move</option>');$(".nav-item-move-to-parent select").append(_newNavTypeDropdownSelector.html());var b=$(".nav-item-container").filter(function(){return $(this).find(".nav-item-url").length===0});b.find('.nav-item-move-to-parent option[value="top-admin-menu"], .nav-item-move-to-parent option[value="left-admin-menu"]').remove();$("#top-admin-menu ul, #left-admin-menu ul:not(#left-admin-menu .sub-nav-items ul), #left-admin-menu .sub-nav-items ul").sortable({update:function(i,j){reassignWeights($(j.item).parent())}})}function sortByMainNavAndWeight(d,c){if((d.menuItem.parent===undefined&&c.menuItem.parent===undefined)||(d.menuItem.parent!==undefined&&c.menuItem.parent!==undefined)){return(parseInt(d.menuItem.weight)<parseInt(c.menuItem.weight)?-1:parseInt(d.menuItem.weight)>parseInt(c.menuItem.weight)?1:0)}else{if(d.menuItem.parent===undefined){return -1}else{return 1}}}function sortByLastModified(e,d){var c=new Date(e.attributes.lastModified);var f=new Date(d.attributes.lastModified);return c<f?-1:c>f?1:0}function getWebAppItems(a){_webAppsFile.download().done(function(b){var c=$.parseJSON(b);if(a){a(c)}}).error(function(b){if(a){a()}})}function saveWebAppItemsFile(b,c){var a=JSON.stringify(b);_webAppsFile.upload(a).done(function(){var d=JSON.stringify(_currentMenuItems);_menuFile.upload(d).done(function(){if(c){c()}})})}function afterSaveWebAppsFile(b,c){_currentMenuItemsArray=[];$.each(_currentMenuItems,function(d){_currentMenuItemsArray.push({menuItem:_currentMenuItems[d],key:d})});_currentMenuItemsArray.sort(sortByMainNavAndWeight);var a=false;$.each(_currentMenuItemsArray,function(k,y){if(y.key.indexOf(_adminMenuLabelsHtmlId)===0){if(y.menuItem.applyIf&&y.menuItem.applyIf.userHasRoles){var L=y.menuItem.applyIf.userHasRoles[0];$("#access-rights-container").find('input[value="'+L+'"]').attr("checked","checked")}if(a===true){_currentMenuItems[y.key]=undefined;return}else{a=true}}var g;var d="blank";var t=false;var l=false;var K=false;var o=y.key.indexOf(_adminMenuLabelsHtmlId)===0;var z="Menu Title";if(b[y.key]!==undefined){z=b[y.key].title}if((y.menuItem.parent===""||y.menuItem.parent===undefined)&&y.key.indexOf("ribbon")!==0){g=$("#left-admin-menu").find("ul:not(#left-admin-menu .sub-nav-items ul)");t=y.key.indexOf("menu-AdminMenuLabels-")==0||o;if(t==false){d=y.key.substring(5)}else{d=_userDefinedNavItemClass}var v=y.menuItem.title;if(v===""){v=z}_newNavTypeDropdownSelector.append($("<option>",{value:y.key+"-subnav"}).text("Left > "+v))}else{if(y.key.indexOf("ribbon")===0){g=$("#top-admin-menu").find("ul");t=true;K=true;$("#no-top-nav-items-label").hide()}else{t=y.key.indexOf("menu-AdminMenuLabels-")==0||o;g=$("#"+y.menuItem.parent+"-subnav ul");l=true}}var B;var C;var x="";var m=(y.menuItem.attr!==undefined&&y.menuItem.attr.target!==undefined&&y.menuItem.attr.target==="_blank");if(m===true){B=_linksToNewWindowTitle;C=_linksToNewWindowGlyphiconClass}else{B=_linksToAdminAreaTitle;C=_linksToAdminAreaGlyphiconClass;x=_graybackButtonClass}var p;var e;var i="";var w=(y.menuItem.visible!==false);if(w===true){p=_visibleGlyphiconClass;e=_visibleTitle}else{p=_invisibleGlyphiconClass;e=_invisibleTitle;i=_graybackButtonClass}var s="";var J="";var I="";var A="";if(y.menuItem.attr!==undefined&&y.menuItem.attr.href!==undefined){A=y.menuItem.attr.href}if(t===false){if(!_currentMenuItems[y.key].applyIf){_currentMenuItems[y.key].applyIf={}}}if(t===true&&o===false){s=['<div class="nav-item-toggle-remove">','<button type="button" class="btn btn-default btn-sm" title="'+_removesNavigationItemTitle+'">','<span class="glyphicon '+_removesNavigationItemGlyphiconClass+'"></span>',"</button>","</div>"].join("\n");J=['<div class="nav-item-url">','<input type="text" class="input-url" value="'+A+'" placeholder="URL" />',"</div>",'<div class="nav-item-toggle-target">','<button type="button" class="btn btn-default btn-sm '+x+'" title="'+B+'">','<span class="glyphicon '+C+'"></span>',"</button>","</div>"].join("\n");var G="Click to change access rights";var q="";if(y.menuItem.solidallowedroles===false){G+="\n\nAccessible to Roles: "+y.menuItem.solidallowedroles;q=_yellowbackButtonClass}}var f="";var H="";if(l===false&&K===false){f=['<div class="nav-item-toggle-subnav">','<button type="button" class="btn btn-default btn-sm '+_graybackButtonClass+'" title="Collapse sub menu items">','<span class="glyphicon '+_subNavigationCollapsedGlyphiconClass+'"></span> Sub Menu',"</button>","</div>"].join("\n");H=['<div id = "'+y.key+'-subnav" class="sub-nav-items" style="display:none;">',"<ul></ul>","</div>"].join("\n");var D="";var j="";var u="";if(y.menuItem.icon!==undefined){u='icon-url="'+y.menuItem.icon+'" ';j="background:url('"+y.menuItem.icon+"') 0 0 no-repeat;";D=_customIconClass}}var h,F,n="";if(RAT.Helper.Primitives.indexOf(_restrictedMenuItems,y.key)>=0){h=_bcRestrictedClass}else{if(o){n=_adminMenuRestrictedClass}}$.each(c,function(M){if(y.key===M){F=_webAppRestrictedClass}});var E="";if(l===true){E=['<div class = "nav-item-move-to-parent">','<select class="moveToParent">',"</select></div>"].join("\n")}var r=["<li>",'<div class="nav-item-container '+h+" "+F+" "+n+'">','<input type="hidden" value="'+y.key+'"/>','<div class="nav-item-image '+d+" "+D+'" '+u+' style="'+j+'" title="Click to change icon">',"</div>",'<div class="nav-item-title">','<input type="text" value="'+y.menuItem.title+'" placeholder="'+z+'" />',"</div>",'<div class="nav-item-weight">','<input type="number" value="'+y.menuItem.weight+'" placeholder="Weight" />',"</div>",'<div class="nav-item-toggle-hide">','<button type="button" class="btn btn-default btn-sm '+i+'" title="'+e+'">','<span class="glyphicon '+p+'"></span>',"</button>","</div>",I,J,E,s,f,H,"</div>","</li>"].join("\n");$(g).append(r)});setNavigationItemButtons();postLoadNavigationData()}function loadNavigationData(){_originalMenuFile.download().done(function(a){_menuFile.download().done(function(c){var b=$.parseJSON(a);_currentMenuItems=$.parseJSON(c);getWebAppItems(function(f){if(!f){f={}}var e=new BCAPI.Models.WebApp.AppCollection();var d=e.fetch();d.fail(function(h,g){saveWebAppItemsFile(f,function(){afterSaveWebAppsFile(b,f)})});d.done(function(h){if(h!==undefined&&h.items!==undefined&&h.items.length>0){var i=1;var g={};$.each(h.items,function(k,o){var j=1;var n=o.name.toLowerCase();n=n.replace(/&gt;/g,"_");n=n.replace(/&lt;/g,"_");n=n.replace(/&quot;/g,"_");n=n.replace(/&amp;/g,"_");n=n.replace(/-/g,"someverycrazystringthatnooneshouldevertrytoenterthisisonlyforthepurposeofreplacingafterthenextreplace");n=n.replace(/&#43;/g,"_");n=n.replace(/\W{1}/g,"_");n=n.replace(/someverycrazystringthatnooneshouldevertrytoenterthisisonlyforthepurposeofreplacingafterthenextreplace/g,"-");var m="menu-webapp-"+n;var l=m;while(g[l]!==undefined){l=m+"-"+j;j+=1}g[l]={};g[l].parent="menu-webapps";g[l].title=o.name;g[l].visible=true;g[l].weight=i;g[l].slug=o.slug;i+=1});$.each(g,function(m){var j=g[m].slug;var k=false;$.each(f,function(n){if(f[n].slug===j){if(_currentMenuItems[n]!==undefined){_currentMenuItems[n].title=g[m].title}if(m!==n){_currentMenuItems[m]=_currentMenuItems[n];f[m]=_currentMenuItems[n];delete _currentMenuItems[n];delete f[n]}k=true;return false}});if(k===false){var l=JSON.stringify(g[m]);_currentMenuItems[m]=$.parseJSON(l);_currentMenuItems[m].slug=undefined;f[m]=$.parseJSON(l)}});$.each(f,function(k){var j=false;$.each(g,function(l){if(f[k]!==undefined&&g[l].slug===f[k].slug){j=true;return false}});if(j===false){delete _currentMenuItems[k];delete f[k]}})}else{f={}}saveWebAppItemsFile(f,function(){afterSaveWebAppsFile(b,f)})})})})})}function isValidTitle(a){return true}function isValidUrl(a){var b='((http|https)(?::\\/{2}[\\w]+)(?:[\\/|\\.]?)(?:[^\\s"]*))';var c=new RegExp(b,["i"]);return c.exec(a)!==null||a.indexOf("/Admin/AppLoader.aspx?client_id=")==0}function getUniqueHtmlId(b){var c=b;c=c.replace(/ /g,"");c=c.replace(/[^a-zA-Z0-9-_]/g,"_");var a=c;var d;var e=1;do{d=$('.nav-item-container input[type="hidden"][value="'+a+'"]',"#editLabelForm").length===1;if(d){a=c+e}e+=1}while(d===true);return a}function addNewLabelToList(u,c,d,f,t,v){var e=$("#"+d+"> ul");if(!t){t=""}var k="blank";var b="";var r="";var o="";var a=v;var g=v!==undefined&&v!==null&&v.indexOf(_adminMenuLabelsHtmlId)===0;if(d==="top-admin-menu"){a=getUniqueHtmlId("ribbon-AdminMenuLabels-"+u);$("#no-top-nav-items-label").hide()}else{if(d==="left-admin-menu"){if(!a){a=getUniqueHtmlId("menu-AdminMenuLabels-"+u)}k=_userDefinedNavItemClass;b=['<div class="nav-item-toggle-subnav">','<button type="button" class="btn btn-default btn-sm '+_graybackButtonClass+'" title="Collapse sub menu items">','<span class="glyphicon '+_subNavigationCollapsedGlyphiconClass+'"></span> Sub Menu',"</button>","</div>"].join("\n");r=['<div id = "'+a+'-subnav" class="sub-nav-items">',"<ul></ul>","</div>"].join("\n");_newNavTypeDropdownSelector.append($("<option>",{value:a+"-subnav"}).text("Left > "+u))}else{if(!a){a=getUniqueHtmlId("menu-AdminMenuLabels-"+u)}o=['<div class = "nav-item-move-to-parent">','<select class="moveToParent">',"</select></div>"].join("\n")}}if(_currentMenuItems[a]===undefined){_currentMenuItems[a]={}}var s,j,q="";if(c!==undefined&&g===false){var n;var m;var l="";if(f===true){n=_linksToNewWindowTitle;m=_linksToNewWindowGlyphiconClass}else{n=_linksToAdminAreaTitle;m=_linksToAdminAreaGlyphiconClass;l=_graybackButtonClass}s=['<div class="nav-item-url">','<input type="text" class="input-url" value="'+c+'" placeholder="URL" />',"</div>",'<div class="nav-item-toggle-target">','<button type="button" class="btn btn-default btn-sm '+l+'" title="'+n+'">','<span class="glyphicon '+m+'"></span>',"</button>","</div>"].join("\n");j=['<div class="nav-item-toggle-remove">','<button type="button" class="btn btn-default btn-sm" title="'+_removesNavigationItemTitle+'">','<span class="glyphicon '+_removesNavigationItemGlyphiconClass+'"></span>',"</button>","</div>"].join("\n");var p="Click to change access rights";var h="";if(_currentMenuItems[a]!==undefined&&_currentMenuItems[a].solidallowedroles===false){p+="\n\nAccessible to Roles: "+value.solidallowedroles;h=_yellowbackButtonClass}}var i=["<li>",'<div class="nav-item-container '+t+'">','<input type="hidden" value="'+a+'"/>','<div class="nav-item-image '+k+'" title="Click to change icon">',"</div>",'<div class="nav-item-title">','<input type="text" value="'+u+'" placeholder="Menu Title" />',"</div>",'<div class="nav-item-weight">','<input type="number" value="-1" placeholder="Weight" />',"</div>",'<div class="nav-item-toggle-hide">','<button type="button" class="btn btn-default btn-sm" title="'+_visibleTitle+'">','<span class="glyphicon '+_visibleGlyphiconClass+'"></span>',"</button>","</div>",q,s,o,j,b,r,"</div>","</li>"].join("\n");e.prepend($(i).hide().fadeIn(1500));reassignWeights(e);$("#"+a+"-subnav").hide();postLoadNavigationData();$("#addLabelForm").find('.form-actions button[type="reset"]').click();setNavigationItemButtons()}function setNavigationItemButtons(){$(".nav-item-toggle-hide button:not(.nav-item-container.restricted .nav-item-toggle-hide button, .nav-item-container.adminmenu-restricted .nav-item-toggle-hide button)").unbind("click").click(function(){var a=$(this).find("span");if(a.hasClass(_visibleGlyphiconClass)){a.removeClass(_visibleGlyphiconClass);a.addClass(_invisibleGlyphiconClass);$(this).addClass(_graybackButtonClass);$(this).attr("title",_invisibleTitle)}else{a.removeClass(_invisibleGlyphiconClass);a.addClass(_visibleGlyphiconClass);$(this).removeClass(_graybackButtonClass);$(this).attr("title",_visibleTitle)}});$(".nav-item-toggle-target button").unbind("click").click(function(){var a=$(this).find("span");if(a.hasClass(_linksToNewWindowGlyphiconClass)){a.removeClass(_linksToNewWindowGlyphiconClass);a.addClass(_linksToAdminAreaGlyphiconClass);$(this).addClass(_graybackButtonClass);$(this).attr("title",_linksToAdminAreaTitle)}else{a.removeClass(_linksToAdminAreaGlyphiconClass);a.addClass(_linksToNewWindowGlyphiconClass);$(this).removeClass(_graybackButtonClass);$(this).attr("title",_linksToNewWindowTitle)}postLoadNavigationData()});$(".nav-item-toggle-subnav button").unbind("click").click(function(){var a=$(this).find("span");if(a.hasClass(_subNavigationExpandedGlyphiconClass)){a.removeClass(_subNavigationExpandedGlyphiconClass);a.addClass(_subNavigationCollapsedGlyphiconClass);$(this).addClass(_graybackButtonClass);$(this).attr("title","Expand sub menu items");$(this).parents(".nav-item-container").find(".sub-nav-items").slideUp()}else{a.removeClass(_subNavigationCollapsedGlyphiconClass);a.addClass(_subNavigationExpandedGlyphiconClass);$(this).removeClass(_graybackButtonClass);$(this).attr("title","Collapse sub menu items");$(this).parents(".nav-item-container").find(".sub-nav-items").slideDown()}});$(".nav-item-toggle-remove button").unbind("click").click(function(){if(window.confirm("Are you sure you want to remove this navigation item?")){var a=$(this).closest(".nav-item-container").find('input[type="hidden"]').first()[0].value;_newNavTypeDropdownSelector.find('option[value="'+a+'-subnav"]').each(function(){$(this).remove()});$(this).closest("li").fadeOut(500,function(){$(this).remove();if($("#top-admin-menu").find(".nav-item-container").length===0){$("#no-top-nav-items-label").show()}postLoadNavigationData()})}});$("#delete-icon").unbind("click").click(function(){var b=$(".library-icon.selected");if(b.hasClass(_defaultIconClass)){window.alert("You may not delete a default icon");return}if(b.length===0){window.alert("You must select an icon to delete");return}if(!window.confirm("Are you sure you want to remove this icon? Any menu items using this icon will no longer display it.")){return}var a=new BCAPI.Models.FileSystem.File("/_System/Apps/solid-admin-menus/_admin"+b.attr("icon-url").substring(1));a.destroy().done(function(){loadMenuIcons()})});$("#select-icon").unbind("click").click(function(){var b=$(".library-icon.selected");if(b.length===0){window.alert("You must select an icon");return}var a="/_System/Apps/solid-admin-menus/_admin"+b.attr("icon-url").substring(1);$(_currentNavItemImage).removeClass(_userDefinedNavItemClass);$(_currentNavItemImage).addClass(_customIconClass);$(_currentNavItemImage).attr("icon-url",a);$(_currentNavItemImage).css("background","url('"+a+"') 0 0 no-repeat");$("#fileUploadModal").modal("hide")});$("#upload-new-icon").find('input[type="file"]').unbind("change").change(function(){var b=this;var h=b.value;if(h.length>0){var g=false;var f;for(var a=0;a<_validFileExtensions.length;a++){f=_validFileExtensions[a];if(h.substr(h.length-f.length,f.length).toLowerCase()==f.toLowerCase()){g=true;break}}if(!g){alert("Sorry, "+h+" is invalid, allowed extensions are: "+_validFileExtensions.join(", "));return}$(".uploading-icon-message","#fileUploadModal").fadeIn();var e=$(b);var d=RAT.Helper.Primitives.generateGuid()+f;var c=BCAPI.Models.FileSystem.Root.file("/_System/Apps/solid-admin-menus/_admin/content/menu-icons/"+d);c.upload($(b)[0].files[0]).done(function(){e.replaceWith(e=e.clone(true));loadMenuIcons(d,function(){$(".uploading-icon-message","#fileUploadModal").fadeOut()})})}});$(".nav-item-access-rights button").unbind("click").click(function(){_currentNavItemAccessRightsButton=$(this);var a=$(this).closest(".nav-item-container").find('input[type="hidden"]').val();_workingMenuItem=_currentMenuItems[a];$("#AllowedList").empty();$("#AvailableRolesList").empty();if(_workingMenuItem.solidallowedroles===true||_workingMenuItem.solidallowedroles===undefined){setAccessRightSectionAvailability(false)}else{setAccessRightSectionAvailability(true)}if(_workingMenuItem.solidallowedroles!==undefined){$.each(_workingMenuItem.solidallowedroles,function(b,c){$("#AllowedList").append("<option>"+c+"</option>")})}$.each(_allAccessRightsList,function(b,c){if(_workingMenuItem.solidallowedroles===undefined||_workingMenuItem.solidallowedroles.indexOf(c)===-1){$("#AvailableRolesList").append("<option>"+c+"</option>")}});$("#menuLabelAccessRightsModal").modal({keyboard:false})});$(".nav-item-container.restricted .nav-item-title input, .nav-item-container.restricted .nav-item-toggle-hide button, .nav-item-container.restricted .nav-item-access-rights button, .nav-item-container.restricted .nav-item-move-to-parent select").attr("title","Renaming, moving or hiding this restricted menu label is not allowed.");$(".nav-item-container.webapp-restricted .nav-item-title input").attr("title","Renaming a Web App's menu label is not allowed");$(".nav-item-container.adminmenu-restricted .nav-item-title input, .nav-item-container.adminmenu-restricted .nav-item-toggle-hide button").attr("title","Renaming and hiding this menu label is not allowed");$(".nav-item-container.restricted .nav-item-title input, .nav-item-container.webapp-restricted .nav-item-title input, .nav-item-container.adminmenu-restricted .nav-item-title input, .nav-item-container.restricted .nav-item-move-to-parent select").attr("disabled","disabled");$(".nav-item-move-to-parent select").unbind("change").change(function(){var d=$(this).find(":selected").val();if(d=="0"||$(this).closest(".sub-nav-items").attr("id")===d){return false}var f=$(this).closest(".nav-item-container");var h=f.find(".nav-item-title input").val();var g=d;var b=f.find(".nav-item-url input").val();var e=f.find(".nav-item-toggle-target button span").hasClass(_linksToNewWindowGlyphiconClass);var c="";if(f.hasClass(_webAppRestrictedClass)){c=_webAppRestrictedClass}else{if(f.hasClass(_bcRestrictedClass)){c=_bcRestrictedClass}else{if(f.hasClass(_adminMenuRestrictedClass)){c=_adminMenuRestrictedClass}}}var a=f.find('input[type="hidden"]').val();addNewLabelToList(h,b,g,e,c,a);$(this).closest("li").fadeOut(500,function(){$(this).remove();postLoadNavigationData()})})}function showItemAddedAlert(){$(".new-item-added-message").show().delay(5000).fadeOut(1000)}function showSavedAlert(){$(".saved-message").show()}function showSaveAlert(){$(".save-actions").hide();$(".saving-message").show()}function revertSaveAlert(){$(".save-actions").show();$(".saving-message").hide()}function saveChanges(){showSaveAlert();var c=$(".nav-item-container","#editLabelForm");var f="";var b=$("#accessRightsForm").find('input[type="checkbox"]:checked');if(b.length===0){f+="You must select at least one role with access rights to this application.\n"}var a,e;$.each(c,function(i,k){var l=$(k);var g=l.find('input[type="hidden"]').first().val();var m=l.find(".nav-item-title input").first().val();var h="";var n=g.indexOf("ribbon-")===0||g.indexOf("menu-AdminMenuLabels-")===0;if(isValidTitle(m)===false){f+='You may only add alphanumeric characters for the "Title"\n'}if(n===true){h=$.trim(l.find(".nav-item-url input").first().val());if(h!==""&&isValidUrl(h)===false){f+='Url format is incorrect: \n   - Urls must start with "http://" or "https://". \n   - App links should be in the form of "/Admin/AppLoader.aspx?client_id={application key}". '}}if(_currentMenuItems[g]===undefined){_currentMenuItems[g]={}}_currentMenuItems[g].title=m;_currentMenuItems[g].weight=l.find(".nav-item-weight input").first().val();_currentMenuItems[g].visible=l.find(".nav-item-toggle-hide button").first().hasClass(_graybackButtonClass)===false;if(_currentMenuItems[g].visible===false){_currentMenuItems[g].applyIf=undefined}else{if(_currentMenuItems[g].solidallowedroles===true){_currentMenuItems[g].applyIf=undefined}else{if(_currentMenuItems[g].solidallowedroles===false){_currentMenuItems[g].applyIf={};_currentMenuItems[g].applyIf.userHasRoles=[];$.each(_currentMenuItems[g].solidallowedroles,function(o,p){_currentMenuItems[g].applyIf.userHasRoles.push(p)})}}}var j=l.find(".nav-item-image").first().hasClass(_customIconClass);if(j===true){_currentMenuItems[g].icon=l.find(".nav-item-image").first().attr("icon-url")}else{_currentMenuItems[g].icon=undefined}if(h!==""){_currentMenuItems[g].attr={};_currentMenuItems[g].attr.href=h;if(l.find(".nav-item-toggle-target button").first().hasClass(_graybackButtonClass)===false){_currentMenuItems[g].attr.target="_blank"}else{_currentMenuItems[g].attr.target=undefined}}else{_currentMenuItems[g].attr=undefined}if(l.closest(".sub-nav-items").length>0){_currentMenuItems[g].parent=l.closest(".sub-nav-items")[0].id.replace(/\-subnav/g,"")}else{_currentMenuItems[g].parent=undefined}if(g.indexOf(_adminMenuLabelsHtmlId)===0){a=_currentMenuItems[g].weight;e=_currentMenuItems[g].parent;_currentMenuItems[g]=undefined}});if(f!==""){alert("Please fix the following errors: \n\n"+f);revertSaveAlert();return}$.each(_currentMenuItems,function(g){if(g!==_adminMenuLabelsHtmlId&&$('.nav-item-container input[type="hidden"][value="'+g+'"]',"#editLabelForm").length===0){_currentMenuItems[g]=undefined}});$.each(b,function(g,i){var h=_adminMenuLabelsHtmlId+g;_currentMenuItems[h]={};_currentMenuItems[h].title="Admin Menu Labels";_currentMenuItems[h].parent=e;_currentMenuItems[h].attr={};_currentMenuItems[h].attr.href="/Admin/AppLoader.aspx?client_id=solid-admin-menus";_currentMenuItems[h].weight=a;_currentMenuItems[h].visible=true;_currentMenuItems[h].applyIf={};_currentMenuItems[h].applyIf.userHasRoles=[];_currentMenuItems[h].applyIf.userHasRoles.push($(i).attr("value"))});var d=JSON.stringify(_currentMenuItems);_menuFile.upload(d).done(function(){if(inIframe()){try{window.parent.location.reload()}catch(g){revertSaveAlert();showSavedAlert()}}else{window.location.reload()}})}function loadMenuIcons(a,b){_menuIconsFolder.fetch().done(function(){var e=_menuIconsFolder.get("contents");e.sort(sortByLastModified);var h=$("#fileUploadModal").find(".library-rows");h.empty();var k;for(var j=0;j<e.length;j++){if(j%15===0){h.append('<div class = "library-row"></div>');k=$(".library-row","#fileUploadModal").last()}var g=e[j];var l=g instanceof BCAPI.Models.FileSystem.File;if(l){var d="";if(a!==undefined&&g.get("name")===a){d="selected"}var f=g.get("name").indexOf("menu_")===0?_defaultIconClass+" ":"";var c="./content/menu-icons/"+g.get("name");k.append('<div class = "library-icon '+f+d+'" icon-url="'+c+'" style="background-image:url(\''+c+"'); background-position: center; background-repeat: no-repeat;\"></div>")}}$(".library-row .library-icon").unbind("click").click(function(i){i.preventDefault();$(".library-row .library-icon").removeClass("selected");$(this).addClass("selected")});if(b!==undefined){b()}})}function restoreDefaultSettings(){if(!window.confirm("This action will restore menu items to their initial view. Are you sure you wish to proceed?")){return}showSaveAlert();_originalMenuFile.download().done(function(a){_menuFile.upload(a).done(function(){if(inIframe()){try{window.parent.location.reload()}catch(b){revertSaveAlert();showSavedAlert()}}else{window.location.reload()}})})}function submitNewMenuItemForm(){var e="";var d=$.trim($("#NewTitle").val());if(d===""){e+='You must enter a value for "Title"\n'}if(isValidTitle(d)===false){e+='You may only add alphanumeric characters for the "Title"\n'}var a=$.trim($("#NewUrl").val());if(a!==""&&isValidUrl(a)===false){e+='Url format is incorrect: \n   - Urls must start with "http://" or "https://". \n   - App links should be in the form of "/Admin/AppLoader.aspx?client_id={application key}". '}if(e!==""){alert("Please fix the following errors: \n\n"+e);return}var b=$("#NewOpenInNewWindow").is(":checked");var c=_newNavTypeDropdownSelector.val();addNewLabelToList(d,a,c,b);showItemAddedAlert()}function setAccessRightSectionAvailability(a){if(a===false){$("#AvailableRolesList").attr("disabled","disabled");$("#MoveToAvailableRolesList").attr("disabled","disabled");$("#MoveToAllowedList").attr("disabled","disabled");$("#AllowedList").attr("disabled","disabled");$("#AllowAllCheckbox").prop("checked",true)}else{$("#AvailableRolesList").removeAttr("disabled");$("#MoveToAvailableRolesList").removeAttr("disabled");$("#MoveToAllowedList").removeAttr("disabled");$("#AllowedList").removeAttr("disabled");$("#AllowAllCheckbox").prop("checked",false)}}function runUpgrades(b){var a=BCAPI.Models.FileSystem.Root.file("/_System/Apps/solid-admin-menus/version.json");a.download().done(function(c){var d=$.parseJSON(c);if(d.version=="1.1.2"){}if(b){b()}}).error(function(c){_menuFile.download().done(function(e){var d=$.parseJSON(e);$.each(d,function(f){if(d[f]!==undefined&&d[f].slug!==undefined){d[f].slug=undefined}if(d[f]!==undefined&&d[f].solidallowallroles!==undefined){d[f].solidallowallroles=undefined}if(d[f]!==undefined&&d[f].solidallowedroles!==undefined){d[f].solidallowedroles=undefined}});updatedMenuItemsString=JSON.stringify(d);_menuFile.upload(updatedMenuItemsString).done(function(){var g={};g.version="1.1.3";var f=JSON.stringify(g);a.upload(f).done(function(){if(b){b()}})})})})}$(function(){_newNavTypeDropdownSelector=$("#NewNavType");$("#addLabelForm").submit(function(a){a.preventDefault();submitNewMenuItemForm()});$("button.save").click(function(){saveChanges()});$("button.restore-default").click(function(){restoreDefaultSettings()});$.ajax({dataType:"json",url:"/api/v2/admin/sites/"+BCAPI.Helper.Site.getSiteId()+"/roles",beforeSend:function(a){a.setRequestHeader("Authorization",BCAPI.Helper.Site.getAccessToken())},success:function(a){$.each(a.items,function(c,d){$("#access-rights-container").find(".controls").append('<label><input type = "checkbox" value="'+d.name+'">'+d.name+"</input></label>");_allAccessRightsList.push(d.name)});var b=function(){loadNavigationData();loadMenuIcons()};runUpgrades(b)}});$("#MoveToAllowedList").click(function(){$("#AvailableRolesList > option:selected").appendTo("#AllowedList")});$("#MoveToAvailableRolesList").click(function(){$("#AllowedList > option:selected").appendTo("#AvailableRolesList")});$("#AllowAllCheckbox").click(function(){setAccessRightSectionAvailability(!($(this).is(":checked")))});$("#SaveAccessRights").click(function(){if($("#AllowAllCheckbox").is(":checked")===false&&$("#AllowedList option").length===0){alert("You must allow at least one role.");return false}if($("#AllowAllCheckbox").is(":checked")){_workingMenuItem.solidallowedroles=true;_currentNavItemAccessRightsButton.removeClass(_yellowbackButtonClass)}else{_workingMenuItem.solidallowedroles=false;_currentNavItemAccessRightsButton.addClass(_yellowbackButtonClass)}_workingMenuItem.solidallowedroles=[];$("#AllowedList option").each(function(a,b){_workingMenuItem.solidallowedroles.push($(b).html())});$("#menuLabelAccessRightsModal").modal("hide")})});