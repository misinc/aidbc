function inIframe(){try{return window.self!==window.top}catch(e){return true}}function hasSubNavItems(e){return $(e).find(".sub-nav-items .nav-item-container").length>0}function isAdminTarget(e){return $(e).find(".nav-item-toggle-target span."+_linksToAdminAreaGlyphiconClass).length===1}function reassignWeights(e){function t(e){$.each(e,function(e,t){$(t).find(".nav-item-weight input").first().val((e+1)*1)})}t(e.children("li").children(".nav-item-container"))}function postLoadNavigationData(){var e=$(".nav-item-container:not(.sub-nav-items .nav-item-container)","#left-admin-menu");$(".nav-item-warning-message").remove();var t=e.filter(function(){var e=$(this).find('input[type="url"]').val();return e===""&&hasSubNavItems(this)===false});$('<div class="nav-item-warning-message alert alert-warning">This item will not appear in the menu until either a URL is entered or sub menu items are added</div>').insertBefore(t.find(".sub-nav-items"));var n=e.filter(function(){var e=$(this).find('input[type="url"]:not(.sub-nav-items input[type="url"])').val();return e!==undefined&&e!==""&&hasSubNavItems(this)===true});$('<div class="nav-item-warning-message alert alert-warning">It is not recommended to have a URL on a parent menu item when there are sub menu items</div>').insertBefore(n.find(".sub-nav-items"));var r=$(".sub-nav-items .nav-item-container","#left-admin-menu").filter(function(){var e=$(this).find('input[type="url"]').val();return e!==undefined&&e===""});r.append('<div class="nav-item-warning-message alert alert-warning">Sub menu items should have a URL</div>');var i=$(".nav-item-container:not(.sub-nav-items .nav-item-container)","#left-admin-menu").filter(function(){var e=$(this).find('input[type="url"]:not(.sub-nav-items input[type="url"])').val();return isAdminTarget(this)&&e!==undefined&&e!==""&&e.indexOf("https")!==0});$(_httpsRecommendedForAdminWindowWarningHtml).insertBefore(i.find(".sub-nav-items"));var s=$(".nav-item-container","#top-admin-menu").filter(function(){var e=$(this).find('input[type="url"]').val();return isAdminTarget(this)&&e!==undefined&&e!==""&&e.indexOf("https")!==0});s.append(_httpsRecommendedForAdminWindowWarningHtml);var o=$(".sub-nav-items .nav-item-container","#left-admin-menu").filter(function(){var e=$(this).find('input[type="url"]').val();return isAdminTarget(this)&&e!==undefined&&e!==""&&e.indexOf("https")!==0});o.append(_httpsRecommendedForAdminWindowWarningHtml);e.filter(function(){return hasSubNavItems(this)===false}).find(".nav-item-toggle-subnav").hide();e.filter(function(){return hasSubNavItems(this)===true}).find(".nav-item-toggle-subnav").show();$(".nav-item-image:not(.blank)").unbind("click").click(function(){_currentNavItemImage=this;$("#fileUploadModal").modal({keyboard:false})});$(".nav-item-move-to-parent select").html('<option value="0">Move</option>');$(".nav-item-move-to-parent select").append(_newNavTypeDropdownSelector.html());var u=$(".nav-item-container").filter(function(){return $(this).find(".nav-item-url").length===0});u.find('.nav-item-move-to-parent option[value="top-admin-menu"], .nav-item-move-to-parent option[value="left-admin-menu"]').remove();$("#top-admin-menu ul, #left-admin-menu ul:not(#left-admin-menu .sub-nav-items ul), #left-admin-menu .sub-nav-items ul").sortable({update:function(e,t){reassignWeights($(t.item).parent())}})}function sortByMainNavAndWeight(e,t){if(e.menuItem.parent===undefined&&t.menuItem.parent===undefined||e.menuItem.parent!==undefined&&t.menuItem.parent!==undefined){return parseInt(e.menuItem.weight)<parseInt(t.menuItem.weight)?-1:parseInt(e.menuItem.weight)>parseInt(t.menuItem.weight)?1:0}else if(e.menuItem.parent===undefined){return-1}else{return 1}}function sortByLastModified(e,t){var n=new Date(e.attributes.lastModified);var r=new Date(t.attributes.lastModified);return n<r?-1:n>r?1:0}function loadNavigationData(){_originalMenuFile.download().done(function(e){var t=$.parseJSON(e);_menuFile.download().done(function(e){_currentMenuItems=$.parseJSON(e);var n=new BCAPI.Models.WebApp.AppCollection;var r=n.fetch();r.done(function(e){if(e.items!==undefined&&e.items.length>0){var n=0;var r={};$.each(e.items,function(e,t){var i=1;var s="menu-webapp-"+t.name.toLowerCase();s=s.replace(/ /g,"_");var o=s;while(r[o]!==undefined){o=s+"-"+i;i+=1}r[o]={};r[o].parent="menu-webapps";r[o].title=t.name;r[o].slug=t.slug;r[o].visible=true;r[o].weight=n;n+=1});$.each(r,function(e){var t=r[e].slug;var n=false;$.each(_currentMenuItems,function(i){if(_currentMenuItems[i]!==undefined&&_currentMenuItems[i].slug===t){_currentMenuItems[i].title=r[e].title;if(e!==i){_currentMenuItems[e]=_currentMenuItems[i];delete _currentMenuItems[i]}n=true;return false}});if(n===false){_currentMenuItems[e]=r[e]}});$.each(_currentMenuItems,function(e){if(_currentMenuItems[e]===undefined||_currentMenuItems[e].slug===undefined){return true}var t=false;$.each(r,function(n){if(_currentMenuItems!==undefined&&r[n].slug===_currentMenuItems[e].slug){t=true;return false}});if(t===false){delete _currentMenuItems[e]}})}_currentMenuItemsArray=[];$.each(_currentMenuItems,function(e){_currentMenuItemsArray.push({menuItem:_currentMenuItems[e],key:e})});_currentMenuItemsArray.sort(sortByMainNavAndWeight);var i=false;$.each(_currentMenuItemsArray,function(e,n){if(n.key.indexOf(_adminMenuLabelsHtmlId)===0){if(n.menuItem.applyIf!==undefined&&n.menuItem.applyIf.userHasRoles!==undefined&&n.menuItem.applyIf.userHasRoles.length>0){var r=n.menuItem.applyIf.userHasRoles[0];$("#access-rights-container").find('input[value="'+r+'"]').attr("checked","checked")}if(i===true){_currentMenuItems[n.key]=undefined;return}else{i=true}}var s;var o="blank";var u=false;var a=false;var f=false;var l=n.key.indexOf(_adminMenuLabelsHtmlId)===0;var c="Menu Title";if(t[n.key]!==undefined){c=t[n.key].title}if((n.menuItem.parent===""||n.menuItem.parent===undefined)&&n.key.indexOf("ribbon")!==0){s=$("#left-admin-menu").find("ul:not(#left-admin-menu .sub-nav-items ul)");u=n.key.indexOf("menu-AdminMenuLabels-")==0||l;if(u==false){o=n.key.substring(5)}else{o=_userDefinedNavItemClass}var h=n.menuItem.title;if(h===""){h=c}_newNavTypeDropdownSelector.append($("<option>",{value:n.key+"-subnav"}).text("Left > "+h))}else if(n.key.indexOf("ribbon")===0){s=$("#top-admin-menu").find("ul");u=true;f=true;$("#no-top-nav-items-label").hide()}else{u=n.key.indexOf("menu-AdminMenuLabels-")==0||l;s=$("#"+n.menuItem.parent+"-subnav ul");a=true}var p;var d;var v="";var m=n.menuItem.attr!==undefined&&n.menuItem.attr.target!==undefined&&n.menuItem.attr.target==="_blank";if(m===true){p=_linksToNewWindowTitle;d=_linksToNewWindowGlyphiconClass}else{p=_linksToAdminAreaTitle;d=_linksToAdminAreaGlyphiconClass;v=_graybackButtonClass}var g;var y;var b="";var w=n.menuItem.visible!==false;if(w===true){g=_visibleGlyphiconClass;y=_visibleTitle}else{g=_invisibleGlyphiconClass;y=_invisibleTitle;b=_graybackButtonClass}var E="";var S="";var x="";var T="";if(n.menuItem.attr!==undefined&&n.menuItem.attr.href!==undefined){T=n.menuItem.attr.href}if(u===true&&l===false){E=['<div class="nav-item-toggle-remove">','<button type="button" class="btn btn-default btn-sm" title="'+_removesNavigationItemTitle+'">','<span class="glyphicon '+_removesNavigationItemGlyphiconClass+'"></span>',"</button>","</div>"].join("\n");S=['<div class="nav-item-url">','<input type="url" value="'+T+'" placeholder="URL" />',"</div>",'<div class="nav-item-toggle-target">','<button type="button" class="btn btn-default btn-sm '+v+'" title="'+p+'">','<span class="glyphicon '+d+'"></span>',"</button>","</div>"].join("\n");var N="Click to change access rights";var C="";if(n.menuItem.solidallowallroles===false){N+="\n\nAccessible to Roles: "+n.menuItem.solidallowedroles;C=_yellowbackButtonClass}x=['<div class="nav-item-access-rights">','<button type="button" class="btn btn-default btn-sm '+C+'" title="'+N+'">','<span class="glyphicon '+_accessRightsGlyphiconClass+'"></span>',"</button>","</div>"].join("\n")}var k="";var L="";if(a===false&&f===false){k=['<div class="nav-item-toggle-subnav">','<button type="button" class="btn btn-default btn-sm '+_graybackButtonClass+'" title="Collapse sub menu items">','<span class="glyphicon '+_subNavigationCollapsedGlyphiconClass+'"></span> Sub Menu',"</button>","</div>"].join("\n");L=['<div id = "'+n.key+'-subnav" class="sub-nav-items" style="display:none;">',"<ul></ul>","</div>"].join("\n");var A="";var O="";var M="";if(n.menuItem.icon!==undefined){M='icon-url="'+n.menuItem.icon+'" ';O="background:url('"+n.menuItem.icon+"') 0 0 no-repeat;";A=_customIconClass}}var _,D,P="";if(RAT.Helper.Primitives.indexOf(_restrictedMenuItems,n.key)>=0){_=_bcRestrictedClass}else if(l){P=_adminMenuRestrictedClass}var H=n.menuItem.slug;if(H){D=_webAppRestrictedClass}var B="";if(a===true){B=['<div class = "nav-item-move-to-parent">','<select class="moveToParent">',"</select></div>"].join("\n")}var j=["<li>",'<div class="nav-item-container '+_+" "+D+" "+P+'">','<input type="hidden" value="'+n.key+'"/>','<div class="nav-item-image '+o+" "+A+'" '+M+' style="'+O+'" title="Click to change icon">',"</div>",'<div class="nav-item-title">','<input type="text" value="'+n.menuItem.title+'" placeholder="'+c+'" />',"</div>",'<div class="nav-item-weight">','<input type="number" value="'+n.menuItem.weight+'" placeholder="Weight" />',"</div>",'<div class="nav-item-toggle-hide">','<button type="button" class="btn btn-default btn-sm '+b+'" title="'+y+'">','<span class="glyphicon '+g+'"></span>',"</button>","</div>",x,S,B,E,k,L,"</div>","</li>"].join("\n");$(s).append(j)});setNavigationItemButtons();postLoadNavigationData()});r.fail(function(e,t){})})})}function isValidTitle(e){return true}function isValidUrl(e){var t='((?:http|https)(?::\\/{2}[\\w]+)(?:[\\/|\\.]?)(?:[^\\s"]*))';var n=new RegExp(t,["i"]);return n.exec(e)!==null}function getUniqueHtmlId(e){var t=e;t=t.replace(/ /g,"");t=t.replace(/[^a-zA-Z0-9-_]/g,"_");var n=t;var r;var i=1;do{r=$('.nav-item-container input[type="hidden"][value="'+n+'"]',"#editLabelForm").length===1;if(r){n=t+i}i+=1}while(r===true);return n}function addNewLabelToList(e,t,n,r,i,s){var o=$("#"+n+"> ul");if(!i){i=""}var u="blank";var a="";var f="";var l="";var c=s;var h=s!==undefined&&s!==null&&s.indexOf(_adminMenuLabelsHtmlId)===0;if(n==="top-admin-menu"){c=getUniqueHtmlId("ribbon-AdminMenuLabels-"+e);$("#no-top-nav-items-label").hide()}else if(n==="left-admin-menu"){if(!c){c=getUniqueHtmlId("menu-AdminMenuLabels-"+e)}u=_userDefinedNavItemClass;a=['<div class="nav-item-toggle-subnav">','<button type="button" class="btn btn-default btn-sm '+_graybackButtonClass+'" title="Collapse sub menu items">','<span class="glyphicon '+_subNavigationCollapsedGlyphiconClass+'"></span> Sub Menu',"</button>","</div>"].join("\n");f=['<div id = "'+c+'-subnav" class="sub-nav-items">',"<ul></ul>","</div>"].join("\n");_newNavTypeDropdownSelector.append($("<option>",{value:c+"-subnav"}).text("Left > "+e))}else{if(!c){c=getUniqueHtmlId("menu-AdminMenuLabels-"+e)}l=['<div class = "nav-item-move-to-parent">','<select class="moveToParent">',"</select></div>"].join("\n")}_currentMenuItems[c]={};var p,d,v="";if(t!==undefined&&h===false){var m;var g;var y="";if(r===true){m=_linksToNewWindowTitle;g=_linksToNewWindowGlyphiconClass}else{m=_linksToAdminAreaTitle;g=_linksToAdminAreaGlyphiconClass;y=_graybackButtonClass}p=['<div class="nav-item-url">','<input type="url" value="'+t+'" placeholder="URL" />',"</div>",'<div class="nav-item-toggle-target">','<button type="button" class="btn btn-default btn-sm '+y+'" title="'+m+'">','<span class="glyphicon '+g+'"></span>',"</button>","</div>"].join("\n");d=['<div class="nav-item-toggle-remove">','<button type="button" class="btn btn-default btn-sm" title="'+_removesNavigationItemTitle+'">','<span class="glyphicon '+_removesNavigationItemGlyphiconClass+'"></span>',"</button>","</div>"].join("\n");var b="Click to change access rights";var w="";if(_currentMenuItems[c]!==undefined&&_currentMenuItems[c].solidallowallroles===false){b+="\n\nAccessible to Roles: "+value.solidallowedroles;w=_yellowbackButtonClass}v=['<div class="nav-item-access-rights">','<button type="button" class="btn btn-default btn-sm '+w+'" title="'+b+'">','<span class="glyphicon '+_accessRightsGlyphiconClass+'"></span>',"</button>","</div>"].join("\n")}var E=["<li>",'<div class="nav-item-container '+i+'">','<input type="hidden" value="'+c+'"/>','<div class="nav-item-image '+u+'" title="Click to change icon">',"</div>",'<div class="nav-item-title">','<input type="text" value="'+e+'" placeholder="Menu Title" />',"</div>",'<div class="nav-item-weight">','<input type="number" value="-1" placeholder="Weight" />',"</div>",'<div class="nav-item-toggle-hide">','<button type="button" class="btn btn-default btn-sm" title="'+_visibleTitle+'">','<span class="glyphicon '+_visibleGlyphiconClass+'"></span>',"</button>","</div>",v,p,l,d,a,f,"</div>","</li>"].join("\n");o.prepend($(E).hide().fadeIn(1500));reassignWeights(o);$("#"+c+"-subnav").hide();postLoadNavigationData();$("#addLabelForm").find('.form-actions button[type="reset"]').click();setNavigationItemButtons()}function setNavigationItemButtons(){$(".nav-item-toggle-hide button:not(.nav-item-container.restricted .nav-item-toggle-hide button, .nav-item-container.adminmenu-restricted .nav-item-toggle-hide button)").unbind("click").click(function(){var e=$(this).find("span");if(e.hasClass(_visibleGlyphiconClass)){e.removeClass(_visibleGlyphiconClass);e.addClass(_invisibleGlyphiconClass);$(this).addClass(_graybackButtonClass);$(this).attr("title",_invisibleTitle)}else{e.removeClass(_invisibleGlyphiconClass);e.addClass(_visibleGlyphiconClass);$(this).removeClass(_graybackButtonClass);$(this).attr("title",_visibleTitle)}});$(".nav-item-toggle-target button").unbind("click").click(function(){var e=$(this).find("span");if(e.hasClass(_linksToNewWindowGlyphiconClass)){e.removeClass(_linksToNewWindowGlyphiconClass);e.addClass(_linksToAdminAreaGlyphiconClass);$(this).addClass(_graybackButtonClass);$(this).attr("title",_linksToAdminAreaTitle)}else{e.removeClass(_linksToAdminAreaGlyphiconClass);e.addClass(_linksToNewWindowGlyphiconClass);$(this).removeClass(_graybackButtonClass);$(this).attr("title",_linksToNewWindowTitle)}postLoadNavigationData()});$(".nav-item-toggle-subnav button").unbind("click").click(function(){var e=$(this).find("span");if(e.hasClass(_subNavigationExpandedGlyphiconClass)){e.removeClass(_subNavigationExpandedGlyphiconClass);e.addClass(_subNavigationCollapsedGlyphiconClass);$(this).addClass(_graybackButtonClass);$(this).attr("title","Expand sub menu items");$(this).parents(".nav-item-container").find(".sub-nav-items").slideUp()}else{e.removeClass(_subNavigationCollapsedGlyphiconClass);e.addClass(_subNavigationExpandedGlyphiconClass);$(this).removeClass(_graybackButtonClass);$(this).attr("title","Collapse sub menu items");$(this).parents(".nav-item-container").find(".sub-nav-items").slideDown()}});$(".nav-item-toggle-remove button").unbind("click").click(function(){if(window.confirm("Are you sure you want to remove this navigation item?")){var e=$(this).closest(".nav-item-container").find('input[type="hidden"]').first()[0].value;_newNavTypeDropdownSelector.find('option[value="'+e+'-subnav"]').each(function(){$(this).remove()});$(this).closest("li").fadeOut(500,function(){$(this).remove();if($("#top-admin-menu").find(".nav-item-container").length===0){$("#no-top-nav-items-label").show()}postLoadNavigationData()})}});$("#delete-icon").unbind("click").click(function(){var e=$(".library-icon.selected");if(e.hasClass(_defaultIconClass)){window.alert("You may not delete a default icon");return}if(e.length===0){window.alert("You must select an icon to delete");return}if(!window.confirm("Are you sure you want to remove this icon? Any menu items using this icon will no longer display it.")){return}var t=new BCAPI.Models.FileSystem.File("/_System/Apps/solid-admin-menus/_admin"+e.attr("icon-url").substring(1));t.destroy().done(function(){loadMenuIcons()})});$("#select-icon").unbind("click").click(function(){var e=$(".library-icon.selected");if(e.length===0){window.alert("You must select an icon");return}var t="/_System/Apps/solid-admin-menus/_admin"+e.attr("icon-url").substring(1);$(_currentNavItemImage).removeClass(_userDefinedNavItemClass);$(_currentNavItemImage).addClass(_customIconClass);$(_currentNavItemImage).attr("icon-url",t);$(_currentNavItemImage).css("background","url('"+t+"') 0 0 no-repeat");$("#fileUploadModal").modal("hide")});$("#upload-new-icon").find('input[type="file"]').unbind("change").change(function(){var e=this;var t=e.value;if(t.length>0){var n=false;var r;for(var i=0;i<_validFileExtensions.length;i++){r=_validFileExtensions[i];if(t.substr(t.length-r.length,r.length).toLowerCase()==r.toLowerCase()){n=true;break}}if(!n){alert("Sorry, "+t+" is invalid, allowed extensions are: "+_validFileExtensions.join(", "));return}$(".uploading-icon-message","#fileUploadModal").fadeIn();var s=$(e);var o=RAT.Helper.Primitives.generateGuid()+r;var u=BCAPI.Models.FileSystem.Root.file("/_System/Apps/solid-admin-menus/_admin/content/menu-icons/"+o);u.upload($(e)[0].files[0]).done(function(){s.replaceWith(s=s.clone(true));loadMenuIcons(o,function(){$(".uploading-icon-message","#fileUploadModal").fadeOut()})})}});$(".nav-item-access-rights button").unbind("click").click(function(){_currentNavItemAccessRightsButton=$(this);var e=$(this).closest(".nav-item-container").find('input[type="hidden"]').val();_workingMenuItem=_currentMenuItems[e];$("#AllowedList").empty();$("#AvailableRolesList").empty();if(_workingMenuItem.solidallowallroles===true||_workingMenuItem.solidallowallroles===undefined){setAccessRightSectionAvailability(false)}else{setAccessRightSectionAvailability(true)}if(_workingMenuItem.solidallowedroles!==undefined){$.each(_workingMenuItem.solidallowedroles,function(e,t){$("#AllowedList").append("<option>"+t+"</option>")})}$.each(_allAccessRightsList,function(e,t){if(_workingMenuItem.solidallowedroles===undefined||_workingMenuItem.solidallowedroles.indexOf(t)===-1){$("#AvailableRolesList").append("<option>"+t+"</option>")}});$("#menuLabelAccessRightsModal").modal({keyboard:false})});$(".nav-item-container.restricted .nav-item-title input, .nav-item-container.restricted .nav-item-toggle-hide button, .nav-item-container.restricted .nav-item-access-rights button, .nav-item-container.restricted .nav-item-move-to-parent select").attr("title","Renaming, moving or hiding this restricted menu label is not allowed.");$(".nav-item-container.webapp-restricted .nav-item-title input").attr("title","Renaming a Web App's menu label is not allowed");$(".nav-item-container.adminmenu-restricted .nav-item-title input, .nav-item-container.adminmenu-restricted .nav-item-toggle-hide button").attr("title","Renaming and hiding this menu label is not allowed");$(".nav-item-container.restricted .nav-item-title input, .nav-item-container.webapp-restricted .nav-item-title input, .nav-item-container.adminmenu-restricted .nav-item-title input, .nav-item-container.restricted .nav-item-move-to-parent select").attr("disabled","disabled");$(".nav-item-move-to-parent select").unbind("change").change(function(){var e=$(this).find(":selected").val();if(e=="0"||$(this).closest(".sub-nav-items").attr("id")===e){return false}var t=$(this).closest(".nav-item-container");var n=t.find(".nav-item-title input").val();var r=e;var i=t.find(".nav-item-url input").val();var s=t.find(".nav-item-toggle-target button span").hasClass(_linksToNewWindowGlyphiconClass);var o="";if(t.hasClass(_webAppRestrictedClass)){o=_webAppRestrictedClass}else if(t.hasClass(_bcRestrictedClass)){o=_bcRestrictedClass}else if(t.hasClass(_adminMenuRestrictedClass)){o=_adminMenuRestrictedClass}var u=t.find('input[type="hidden"]').val();addNewLabelToList(n,i,r,s,o,u);$(this).closest("li").fadeOut(500,function(){$(this).remove();postLoadNavigationData()})})}function showItemAddedAlert(){$(".new-item-added-message").show().delay(5e3).fadeOut(1e3)}function showSavedAlert(){$(".saved-message").show()}function showSaveAlert(){$(".save-actions").hide();$(".saving-message").show()}function revertSaveAlert(){$(".save-actions").show();$(".saving-message").hide()}function saveChanges(){showSaveAlert();var e=$(".nav-item-container","#editLabelForm");var t="";var n=$("#accessRightsForm").find('input[type="checkbox"]:checked');if(n.length===0){t+="You must select at least one role with access rights to this application.\n"}var r,i;$.each(e,function(e,n){var s=$(n);var o=s.find('input[type="hidden"]').first().val();var u=s.find(".nav-item-title input").first().val();var a="";var f=o.indexOf("ribbon-")===0||o.indexOf("menu-AdminMenuLabels-")===0;if(isValidTitle(u)===false){t+='You may only add alphanumeric characters for the "Title"\n'}if(f===true){a=$.trim(s.find(".nav-item-url input").first().val());if(a!==""&&isValidUrl(a)===false){t+='You must enter Urls starting with "http://" or "https://"'}}if(_currentMenuItems[o]===undefined){_currentMenuItems[o]={}}_currentMenuItems[o].title=u;_currentMenuItems[o].weight=s.find(".nav-item-weight input").first().val();_currentMenuItems[o].visible=s.find(".nav-item-toggle-hide button").first().hasClass(_graybackButtonClass)===false;if(_currentMenuItems[o].visible===false){_currentMenuItems[o].applyIf=undefined}else{if(_currentMenuItems[o].solidallowallroles===true){_currentMenuItems[o].applyIf=undefined}else if(_currentMenuItems[o].solidallowallroles===false){_currentMenuItems[o].applyIf={};_currentMenuItems[o].applyIf.userHasRoles=[];$.each(_currentMenuItems[o].solidallowedroles,function(e,t){_currentMenuItems[o].applyIf.userHasRoles.push(t)})}}var l=s.find(".nav-item-image").first().hasClass(_customIconClass);if(l===true){_currentMenuItems[o].icon=s.find(".nav-item-image").first().attr("icon-url")}else{_currentMenuItems[o].icon=undefined}if(a!==""){_currentMenuItems[o].attr={};_currentMenuItems[o].attr.href=a;if(s.find(".nav-item-toggle-target button").first().hasClass(_graybackButtonClass)===false){_currentMenuItems[o].attr.target="_blank"}else{_currentMenuItems[o].attr.target=undefined}}else{_currentMenuItems[o].attr=undefined}if(s.closest(".sub-nav-items").length>0){_currentMenuItems[o].parent=s.closest(".sub-nav-items")[0].id.replace(/\-subnav/g,"")}else{_currentMenuItems[o].parent=undefined}if(o.indexOf(_adminMenuLabelsHtmlId)===0){r=_currentMenuItems[o].weight;i=_currentMenuItems[o].parent;_currentMenuItems[o]=undefined}});if(t!==""){alert("Please fix the following errors: \n"+t);revertSaveAlert();return}$.each(_currentMenuItems,function(e){if(e!==_adminMenuLabelsHtmlId&&$('.nav-item-container input[type="hidden"][value="'+e+'"]',"#editLabelForm").length===0){_currentMenuItems[e]=undefined}});$.each(n,function(e,t){var n=_adminMenuLabelsHtmlId+e;_currentMenuItems[n]={};_currentMenuItems[n].title="Admin Menu Labels";_currentMenuItems[n].parent=i;_currentMenuItems[n].attr={};_currentMenuItems[n].attr.href="/Admin/AppLoader.aspx?client_id=solid-admin-menus";_currentMenuItems[n].weight=r;_currentMenuItems[n].visible=true;_currentMenuItems[n].applyIf={};_currentMenuItems[n].applyIf.userHasRoles=[];_currentMenuItems[n].applyIf.userHasRoles.push($(t).attr("value"))});if(_currentMenuItems[_adminMenuLabelsHtmlId]!==undefined){_currentMenuItems[_adminMenuLabelsHtmlId]=undefined}var s=JSON.stringify(_currentMenuItems);_menuFile.upload(s).done(function(){if(inIframe()){try{window.parent.location.reload()}catch(e){revertSaveAlert();showSavedAlert()}}else{window.location.reload()}})}function loadMenuIcons(e,t){_menuIconsFolder.fetch().done(function(){var n=_menuIconsFolder.get("contents");n.sort(sortByLastModified);var r=$("#fileUploadModal").find(".library-rows");r.empty();var i;for(var s=0;s<n.length;s++){if(s%15===0){r.append('<div class = "library-row"></div>');i=$(".library-row","#fileUploadModal").last()}var o=n[s];var u=o instanceof BCAPI.Models.FileSystem.File;if(u){var a="";if(e!==undefined&&o.get("name")===e){a="selected"}var f=o.get("name").indexOf("menu_")===0?_defaultIconClass+" ":"";var l="./content/menu-icons/"+o.get("name");i.append('<div class = "library-icon '+f+a+'" icon-url="'+l+'" style="background-image:url(\''+l+"'); background-position: center; background-repeat: no-repeat;\"></div>")}}$(".library-row .library-icon").unbind("click").click(function(e){e.preventDefault();$(".library-row .library-icon").removeClass("selected");$(this).addClass("selected")});if(t!==undefined){t()}})}function restoreDefaultSettings(){if(!window.confirm("This action will restore menu items to their initial view. Are you sure you wish to proceed?")){return}showSaveAlert();_originalMenuFile.download().done(function(e){_menuFile.upload(e).done(function(){if(inIframe()){try{window.parent.location.reload()}catch(e){revertSaveAlert();showSavedAlert()}}else{window.location.reload()}})})}function submitNewMenuItemForm(){var e="";var t=$.trim($("#NewTitle").val());if(t===""){e+='You must enter a value for "Title"\n'}if(isValidTitle(t)===false){e+='You may only add alphanumeric characters for the "Title"\n'}var n=$.trim($("#NewUrl").val());if(n!==""&&isValidUrl(n)===false){e+='You must enter Urls starting with "http://" or "https://"'}if(e!==""){alert("Please fix the following errors: \n"+e);return}var r=$("#NewOpenInNewWindow").is(":checked");var i=_newNavTypeDropdownSelector.val();addNewLabelToList(t,n,i,r);showItemAddedAlert()}function setAccessRightSectionAvailability(e){if(e===false){$("#AvailableRolesList").attr("disabled","disabled");$("#MoveToAvailableRolesList").attr("disabled","disabled");$("#MoveToAllowedList").attr("disabled","disabled");$("#AllowedList").attr("disabled","disabled");$("#AllowAllCheckbox").prop("checked",true)}else{$("#AvailableRolesList").removeAttr("disabled");$("#MoveToAvailableRolesList").removeAttr("disabled");$("#MoveToAllowedList").removeAttr("disabled");$("#AllowedList").removeAttr("disabled");$("#AllowAllCheckbox").prop("checked",false)}}var _currentMenuItems;var _currentMenuItemsArray;var _currentNavItemImage;var _currentNavItemAccessRightsButton;var _allAccessRightsList=[];var _workingMenuItem;var _menuFile=BCAPI.Models.FileSystem.Root.file("/_System/Apps/solid-admin-menus/_config/menu.json");var _originalMenuFile=BCAPI.Models.FileSystem.Root.file("/_System/Apps/solid-admin-menus/_config/menu_orig.json");var _menuIconsFolder=new BCAPI.Models.FileSystem.Folder("/_System/Apps/solid-admin-menus/_admin/content/menu-icons");var _adminMenuLabelsHtmlId="menu-custom-labels";var _invisibleTitle="Hidden from users";var _visibleTitle="Visible to all users";var _graybackButtonClass="greyback";var _yellowbackButtonClass="yellowback";var _linksToNewWindowTitle="Link opens in a new window";var _linksToAdminAreaTitle="Links opens in admin area";var _removesNavigationItemTitle="Removes navigation item";var _visibleGlyphiconClass="glyphicon-eye-open";var _invisibleGlyphiconClass="glyphicon-eye-close";var _linksToNewWindowGlyphiconClass="glyphicon-new-window";var _linksToAdminAreaGlyphiconClass="glyphicon-unchecked";var _removesNavigationItemGlyphiconClass="glyphicon-minus-sign";var _subNavigationExpandedGlyphiconClass="glyphicon-circle-arrow-down";var _subNavigationCollapsedGlyphiconClass="glyphicon-circle-arrow-right";var _accessRightsGlyphiconClass="glyphicon-user";var _defaultIconClass="default-icon";var _userDefinedNavItemClass="user-defined";var _validFileExtensions=[".png"];var _customIconClass="custom-icon";var _newNavTypeDropdownSelector;var _httpsRecommendedForAdminWindowWarningHtml="<div class=\"nav-item-warning-message alert alert-warning\">'https' is recommended for admin links for maximum compatibility. </div>";var _restrictedMenuItems=["menu-url-redirects","menu-customers-database","menu-payment-gateways","menu-shipping-options","menu-settings-domains","menu-settings-emailaccounts","menu-settings-adminusers","menu-settings-userroles","menu-billing-settings","menu-settings-secure-redirect"];var _bcRestrictedClass="restricted";var _webAppRestrictedClass="webapp-restricted";var _adminMenuRestrictedClass="adminmenu-restricted";$(function(){"use strict";RAT.Helper.BC.appendAccessTokenToAnchors($("#tab-labels, #tab-instructions"));_newNavTypeDropdownSelector=$("#NewNavType");$("#addLabelForm").submit(function(e){e.preventDefault();submitNewMenuItemForm()});$("button.save").click(function(){saveChanges()});$("button.restore-default").click(function(){restoreDefaultSettings()});$.ajax({dataType:"json",url:"/api/v2/admin/sites/"+BCAPI.Helper.Site.getSiteId()+"/roles",beforeSend:function(e){e.setRequestHeader("Authorization",BCAPI.Helper.Site.getAccessToken())},success:function(e){$.each(e.items,function(e,t){$("#access-rights-container").find(""+".controls").append('<label><input type = "checkbox" value="'+t.name+'">'+t.name+"</input></label>");_allAccessRightsList.push(t.name)});loadNavigationData();loadMenuIcons()}});$("#MoveToAllowedList").click(function(){$("#AvailableRolesList > option:selected").appendTo("#AllowedList")});$("#MoveToAvailableRolesList").click(function(){$("#AllowedList > option:selected").appendTo("#AvailableRolesList")});$("#AllowAllCheckbox").click(function(){setAccessRightSectionAvailability(!$(this).is(":checked"))});$("#SaveAccessRights").click(function(){if($("#AllowAllCheckbox").is(":checked")===false&&$("#AllowedList option").length===0){alert("You must allow at least one role.");return false}if($("#AllowAllCheckbox").is(":checked")){_workingMenuItem.solidallowallroles=true;_currentNavItemAccessRightsButton.removeClass(_yellowbackButtonClass)}else{_workingMenuItem.solidallowallroles=false;_currentNavItemAccessRightsButton.addClass(_yellowbackButtonClass)}_workingMenuItem.solidallowedroles=[];$("#AllowedList option").each(function(e,t){_workingMenuItem.solidallowedroles.push($(t).html())});$("#menuLabelAccessRightsModal").modal("hide")})})